version: "3.7"
services:
  zookeeper:
    image: 'bitnami/zookeeper:3.7.0'
    restart: always
    environment:
      ALLOW_ANONYMOUS_LOGIN: "yes"
    ports:
      - 2181:2181
      - 2888:2888
      - 3888:3888

  kafka:
    image: 'bitnami/kafka:2.8.1'
    restart: always
    depends_on:
      - zookeeper
    environment:
      ALLOW_PLAINTEXT_LISTENER: "yes"
      KAFKA_CFG_ZOOKEEPER_CONNECT: "zookeeper:2181"
    ports:
      - 9092:9092




  postgres:
    image: docker.io/bitnami/postgresql:11
    volumes:
      - ./Database/db/init.sql:/docker-entrypoint-initdb.d/init.sql
    environment:
      - POSTGRESQL_USERNAME=postgres
      - POSTGRESQL_DATABASE=tiendita
      - ALLOW_EMPTY_PASSWORD=yes
      - POSTGRESQL_PASSWORD=postgres
    ports:
      - "5432:5432"
  
  #Servidor para labase de datos
  server:
    container_name: servidor
    build:
      context: ./server
      dockerfile: Dockerfile
    dependes_on:
      - postgres
    port:
      - "8030:8030"
  


  # --- Ventas --- 
  venta:
    build:
      context: ./venta
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - zookeeper
      - kafka
    environment:
      PORT: 3000
      kafkaHost: kafka:9092
    volumes: # nose 
      - ./node/index.js:/app/index.js
    ports:
      - 3001:3000
  
  # --- Posicion ---
  posicion:
    build:
      context: ./posicion
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - zookeeper
      - kafka
    environment:
      PORT: 3000
      kafkaHost: kafka:9092
    volumes: # nose 
      - ./node/index.js:/app/index.js
    ports:
      - 3002:3000

  # --- Stock ---
  stock:
    build:
      context: ./stock
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - zookeeper
      - kafka
    environment:
      PORT: 3000
      kafkaHost: kafka:9092
    volumes: # nose 
      - ./node/index.js:/app/index.js
    ports:
      - 3003:3000



fileSystem.writeFile('users.json', "Hola", err=>{
  if(err){
    console.log("Error al escribir en el json" ,err)
  } else {
    console.log('Usuario agregado en el JSON')
  }
  })